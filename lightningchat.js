var LightningChat={devMode:!1,sessionKey:!1,apiBase:"",messages:[],status:null,init:function(t){LightningChat.sessionKey=LightningChat.getCookie("lcskey"),LightningChat.getSession(this.sessionKey,function(n){n?(console.log("LightningChat initialized, session key -> "+LightningChat.sessionKey),LightningChat.messages=n,console.log(n),LightningChat.onMessageLoaded(n),LightningChat.beginHeartBeat(),LightningChat.beginCheckInterval(),t()):LightningChat.newSession(function(n){LightningChat.init(t)})})},onMessageLoaded:function(t){},onNewMessage:function(t){},onStatusChange:function(t){},beginCheckInterval:function(){setInterval(function(){LightningChat.ajax.get(LightningChat.apiBase+"/sessions/"+LightningChat.sessionKey,{},function(t){try{t=JSON.parse(t)}catch(n){return void console.log("Failed to parse response (checkInterval)")}if(t.status&&"notfound"==t.status)console.log("Session key not found (checkInterval)");else{for(i=t.length-(t.length-LightningChat.messages.length);i<t.length;i++)LightningChat.onNewMessage(t[i]);LightningChat.messages=t}}),LightningChat.ajax.get(LightningChat.apiBase+"/sessions/"+LightningChat.sessionKey+"/info",{},function(t){try{t=JSON.parse(t)}catch(n){return void console.log("Failed to parse response (checkInterval-info)")}t.status&&"notfound"==t.status?console.log("Session key not found (checkInterval-info)"):(LightningChat.status!=t.status&&LightningChat.onStatusChange(t.status),LightningChat.status=t.status)})},2e3)},loadSessionEmail:function(t){LightningChat.ajax.get(LightningChat.apiBase+"/sessions/"+LightningChat.sessionKey+"/info",{},function(n){try{n=JSON.parse(n)}catch(e){return void t(!1)}n.status&&"notfound"==n.status?t(!1):"none"==n.email?t(!1):(console.log(n),t(n.email))})},setSessionEmail:function(t,n){LightningChat.ajax.post(LightningChat.apiBase+"/sessions/"+LightningChat.sessionKey+"/email",{email:t},function(t){try{t=JSON.parse(t)}catch(e){return void n(!1)}n(t.status&&"ok"!=t.status?!1:!0)})},validateEmail:function(t){var n=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return n.test(t)},sendMessage:function(t,n){LightningChat.ajax.post(LightningChat.apiBase+"/sessions/"+LightningChat.sessionKey,{message:t},function(t){try{t=JSON.parse(t)}catch(e){return void n(!1)}n(t.status&&"ok"!=t.status?!1:!0)})},beginHeartBeat:function(){setInterval(function(){LightningChat.ajax.get(LightningChat.apiBase+"/sessions/"+LightningChat.sessionKey+"/heartbeat",{},function(){console.log("Heartbeat finished at "+new Date)})},5e3)},getCookie:function(t){for(var n=t+"=",e=decodeURIComponent(document.cookie),i=e.split(";"),s=0;s<i.length;s++){for(var a=i[s];" "==a.charAt(0);)a=a.substring(1);if(0==a.indexOf(n))return a.substring(n.length,a.length)}return!1},getSession:function(t,n){this.ajax.get(this.apiBase+"/sessions/"+t,{},function(t){try{t=JSON.parse(t)}catch(e){return void n(!1)}n(t.status&&"notfound"==t.status?!1:t)})},newSession:function(t){LightningChat.ajax.post(LightningChat.apiBase+"/sessions",{},function(n){try{n=JSON.parse(n)}catch(e){return void t(!1)}LightningChat.setCookie("lcskey",n.session_id,365),t(!0)})},setCookie:function(t,n,e){var i=new Date;i.setTime(i.getTime()+24*e*60*60*1e3);var s="expires="+i.toUTCString();document.cookie=t+"="+n+";"+s+";path=/"},ajax:{x:function(){if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;for(var t,n=["MSXML2.XmlHttp.6.0","MSXML2.XmlHttp.5.0","MSXML2.XmlHttp.4.0","MSXML2.XmlHttp.3.0","MSXML2.XmlHttp.2.0","Microsoft.XmlHttp"],e=0;e<n.length;e++)try{t=new ActiveXObject(n[e]);break}catch(i){}return t},send:function(t,n,e,i,s){void 0===s&&(s=!0);var a=LightningChat.ajax.x();a.open(e,t,s),a.onreadystatechange=function(){4==a.readyState&&n(a.responseText)},"POST"==e&&a.setRequestHeader("Content-type","application/json"),a.send(i)},get:function(t,n,e,i){var s=[];for(var a in n)s.push(encodeURIComponent(a)+"="+encodeURIComponent(n[a]));LightningChat.ajax.send(t+(s.length?"?"+s.join("&"):""),e,"GET",null,i)},post:function(t,n,e,i){LightningChat.ajax.send(t,e,"POST",JSON.stringify(n),i)}}};
// Modify this
LightningChat.devMode = true;
LightningChat.apiBase = "http://localhost:3000";
// STOP here
function reloadSessionEmail(){LightningChat.loadSessionEmail(function(t){t?($("#lightning-chat-email-form").slideUp(),$("#lightning-chat-email-status label").html("Hi! "+t),$("#lightning-chat-email-status").slideDown()):($("#lightning-chat-email-form").slideDown(),$("#lightning-chat-email-status").slideUp())})}$("body").append('<link href="https://ssl.jackzh.com/file/css/font-awesome-4.4.0/css/font-awesome.min.css" rel="stylesheet" type="text/css" />'),$("body").append('<div id="lightning-chat-container" class="lightning-chat-reset"><button id="begin-chat-button" class="lightning-chat-reset"><i class="fa fa-comments" aria-hidden="true"></i></button><div id="content-container" class="not-shown lightning-chat-reset"><div id="title" class="lightning-chat-reset">Welcome to AMACSS! How can we help?<br><br><div id="lightning-chat-email-form" class="lightning-chat-reset" style="display: none;"><label>What is you email address? if you are away, you will recieve an email notification when we reply.</label><input type="text" name="email" class="lightning-chat-reset" id="lightning-chat-email-box" /></div><div id="lightning-chat-email-status" style="display: none;" class="lightning-chat-reset"><label></label></div></div><div id="bubble-container" class="lightning-chat-reset"></div><div id="controls" class="lightning-chat-reset"><input type="text" id="lighting-message-area" placeholder="Enter your message" class="lightning-chat-reset" /></div><div id="new-chat-controls" class="lightning-chat-reset"><i class="fa fa-refresh" aria-hidden="true"></i> New Chat</div></div></div>'),$("body").append("<style>.lightning-chat-reset {padding: 0;margin: 0;border: none;outline: none;position: static;}#lightning-chat-container {position: fixed;right: 20px;bottom: 20px;font-family: Arial, Helvetica, sans-serif;}#lightning-chat-container #begin-chat-button {background-color: #1E88E5;color: white;border: none;font-size: 25px;border-radius: 100px;height: 60px;width: 60px;box-shadow: rgba(0,0,0,0.2) 5px 5px 10px;cursor: pointer;transition: all ease 0.3s;}#lightning-chat-container #begin-chat-button:hover {background-color: #0D47A1;transition: all ease 0.3s;}#lightning-chat-container #begin-chat-button.active {background-color: #0D47A1;}#lightning-chat-container #content-container {background-color: white;width: 400px;position: absolute;bottom: 80px;right: 0;height: auto;box-shadow: rgba(0,0,0,0.2) 3px 3px 10px;border-radius: 10px;overflow: hidden;transition: all ease 0.5s;opacity: 1;}#lightning-chat-container.closed #content-container {background-color: #E0E0E0;}#lightning-chat-container.closed #content-container #bubble-container {opacity: 0.7;}#lightning-chat-container.closed #controls {display: none;}#lightning-chat-container.closed #new-chat-controls {display: block;}#lightning-chat-container #content-container.not-shown {right: -500px;transition: all ease 0.5s;opacity: 0;}#lightning-chat-container #title {background-color: #1976D2;color: white;padding: 20px;}#lightning-chat-container #title label {display: block;font-size: 13px;color: #90CAF9;}#lightning-chat-container #title input {background-color: transparent;color: white;outline: none;border: none;border-bottom: rgba(255,255,255,0.3) 2px solid;}#lightning-chat-container #title input.error {border-bottom: red 2px solid;}#lightning-chat-container #controls {height: 45px;background-color: #FAFAFA;border-top: #EEEEEE 2px solid;width: 90%;padding-left: 5%;padding-right: 5%;}#lightning-chat-container #new-chat-controls {display: none;height: 45px;background-color: #1E88E5;border-top: #1E88E5 2px solid;text-align: center;line-height: 45px;color: white;font-size: 13px;cursor: pointer;transition: all ease 0.3s;}#lightning-chat-container #new-chat-controls:hover {background-color: #1565C0;transition: all ease 0.3s;}#lightning-chat-container #controls input {height: 45px;/*border: none;*/font-size: 14px;/*line-height: 40px;*/border: none;outline: none;background-color: transparent;width: 100%;}#lightning-chat-container #bubble-container {/*position: absolute;*/bottom: 50px;left: 0;height: 400px;max-height: 70%;overflow-y: scroll;padding-bottom: 20px;}#lightning-chat-container #bubble-container .left-bubble,#lightning-chat-container #bubble-container .right-bubble {padding: 15px;padding-bottom: 0;}#lightning-chat-container #bubble-container .right-bubble {text-align: right;  }#lightning-chat-container #bubble-container .left-bubble p,#lightning-chat-container #bubble-container .right-bubble p {padding: 10px;margin: 0;display: inline-block;padding-left: 15px;padding-right: 15px;font-size: 14px;border-radius: 20px;}#lightning-chat-container #bubble-container .left-bubble p {background-color: #F5F5F5;color: #424242;border-top-left-radius: 0px;}#lightning-chat-container #bubble-container .right-bubble p {background-color: #039BE5;color: #E1F5FE;border-bottom-right-radius: 0px;}</style>"),LightningChat.init(function(){reloadSessionEmail()}),$("#new-chat-controls").click(function(){LightningChat.setCookie("lcskey","",-1),LightningChat.init(function(){reloadSessionEmail()})}),$("#lightning-chat-email-box").blur(function(){LightningChat.validateEmail($(this).val())?($(this).removeClass("error"),$(this).attr("disabled",!0),LightningChat.setSessionEmail($(this).val(),function(t){t?($("#lightning-chat-email-box").val(""),reloadSessionEmail()):($(this).attr("disabled",!1),$(this).addClass("error"))})):$(this).addClass("error")}),LightningChat.onMessageLoaded=function(t){$("#bubble-container").html("");for(i in t){if("visitor"==t[i].sender)var n="right-bubble";else var n="left-bubble";$("#bubble-container").append("<div class='"+n+"'><p>"+t[i].message+"</p></div>")}$("#bubble-container").scrollTop($("#bubble-container")[0].scrollHeight)},LightningChat.onNewMessage=function(t){if("visitor"==t.sender)var n="right-bubble";else var n="left-bubble";$("#bubble-container").append("<div class='"+n+"'><p>"+t.message+"</p></div>"),$("#bubble-container").scrollTop($("#bubble-container")[0].scrollHeight)},LightningChat.onStatusChange=function(t){0==t?$("#lightning-chat-container").addClass("closed"):$("#lightning-chat-container").removeClass("closed")},$("#lighting-message-area").keyup(function(t){if(13==t.keyCode&&""!=$("#lighting-message-area").val()){var n=$("#lighting-message-area").val();$("#lighting-message-area").val(""),LightningChat.sendMessage(n,function(t){t||alert("failed to send message")})}}),$("#begin-chat-button").click(function(){$("#content-container").toggleClass("not-shown"),$(this).toggleClass("active")});